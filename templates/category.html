<!doctype html>
<html
  th:replace="~{modules/layout :: html(title = |${category.spec.displayName} - ${site.title}|, content = ~{::content}, head = null, footer = null, sidebar = ~{::sidebar}, contentClass = '')}"
  xmlns:th="https://www.thymeleaf.org"
>
  <th:block th:fragment="content">
    <th:block th:replace="~{modules/header}" />
    <!--  Category Title  -->
    <div class="mt-16 bg-gray-400/5 px-4 py-12 sm:px-6 sm:py-16 lg:px-8 dark:bg-white/5" th:attr="id=|items-${category.metadata.name}|">
      <div class="mx-auto max-w-3xl">
        <div class="mb-4 flex flex-col items-center justify-center sm:mb-6">
          <div
            class="mb-3 flex h-12 w-12 flex-col items-center justify-center rounded-xl p-4 shadow-lg sm:mb-4 sm:h-16 sm:w-16 sm:rounded-2xl"
            th:classappend="${#annotations.getOrDefault(category, 'color', 'gradient-bg-9')}"
          >
            <i class="shrink-0 text-3xl text-white" th:classappend="${#annotations.getOrDefault(category, 'font', '')}"></i>
          </div>
          <h3 class="text-2xl font-bold text-gray-900/70 sm:text-3xl dark:text-white/70" th:text="${category.spec.displayName}"></h3>
        </div>
        <div class="mx-auto mb-6 px-4 sm:mb-8">
          <p class="text-center text-sm leading-relaxed text-gray-600 sm:text-base dark:text-gray-300" th:text="${category.spec.description}"></p>
        </div>
        <div class="flex items-center justify-center space-x-4 text-xs text-gray-500 sm:flex-row sm:text-sm lg:space-x-8 dark:text-gray-400">
          <div class="flex items-center">
            <i class="fas fa-file-alt mr-2"></i>
            <span th:text="|${category.postCount != null ? category.postCount : 0} | + |#{page.archives.title.post}| "></span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-eye mr-2"></i>
            <span id="category-visit"></span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-calendar mr-2"></i>
            <span
              class="inline"
              th:if="${#locale.language == 'zh'}"
              th:text="#{page.archives.date_zh2(${#dates.format(category.metadata.creationTimestamp,'dd')},${#dates.format(category.metadata.creationTimestamp,'MM')},${#dates.format(category.metadata.creationTimestamp,'yyyy')})}"
            ></span>
            <span
              class="inline"
              th:if="${#locale.language != 'zh'}"
              th:text="#{page.archives.date(${#dates.format(category.metadata.creationTimestamp,'dd')},${#dates.format(category.metadata.creationTimestamp,'MMM')},${#dates.format(category.metadata.creationTimestamp,'yyyy')})}"
            ></span>
          </div>
        </div>
      </div>
    </div>
    <!--  Category  -->
    <section class="mx-auto max-w-7xl px-2 py-8 md:px-4">
      <div class="relative grid grid-cols-1 gap-8" th:classappend="${posts.total == 0 ? '' : 'lg:grid-cols-4'}">
        <ul class="category-post col-span-full space-y-8" th:classappend="${posts.total == 0 ? '' : 'lg:col-span-3'}">
          <li th:each="post : ${posts.items}">
            <div class="overflow-hidden rounded-2xl border border-white/20 shadow-xl backdrop-blur-sm transition-all duration-300 ease-out hover:-translate-y-2 hover:shadow-2xl">
              <div class="relative h-72 sm:h-80">
                <th:block th:if="${not #strings.isEmpty(post.spec.cover)}">
                  <img
                    alt="images"
                    class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500"
                    loading="lazy"
                    sizes="(max-width: 1600px) 100vw, 1600px"
                    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
                    th:src="${post.spec.cover}"
                    th:alt="${post.spec.title}"
                    th:attr="data-src=${post.spec.cover},
                               srcset=|${thumbnail.gen(post.spec.cover, 's')} 400w, ${thumbnail.gen(post.spec.cover, 'm')} 800w, ${thumbnail.gen(post.spec.cover, 'l')} 1200w|"
                  />
                </th:block>
                <th:block th:if="${#strings.isEmpty(post.spec.cover)}">
                  <img
                    alt="images"
                    class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-500"
                    loading="lazy"
                    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
                    th:src="${#theme.assets('/images/blog.avif')}"
                    th:attr="data-src=${#theme.assets('/images/blog.avif')}"
                    th:alt="${post.spec.title}"
                  />
                </th:block>
                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-black/20"></div>
                <div class="absolute top-4 left-4 flex justify-center space-x-2">
                  <a
                    class="rounded-xl border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm md:px-3 md:text-sm"
                    href=""
                    th:each="categories : ${post.categories}"
                    th:href="@{${categories.status.permalink}}"
                    th:text="|${categories.spec.displayName}|"
                    th:title="|分类：${categories.spec.displayName}|"
                  ></a>
                </div>
                <div class="absolute top-1 right-4 rounded-full p-1.5 md:p-2" th:if="${post.spec.pinned}">
                  <i class="fas fa-location-pin text-xs text-gray-400 md:text-xl"></i>
                </div>
                <div class="absolute right-0 bottom-0 left-0 p-3 md:p-4">
                  <div class="mb-3 flex items-center space-x-5">
                    <div class="flex items-center space-x-2">
                      <img alt="" class="h-6 w-6 rounded-full object-cover" th:src="${post.owner.avatar}" />
                      <span class="text-xs text-white md:text-sm" th:text="${post.owner.displayName}"></span>
                    </div>
                    <div class="flex items-center space-x-1 text-xs text-white/80 md:text-sm">
                      <i class="fas fa-calendar-day text-white/60"></i>
                      <span
                        class="text-xs text-white/80 md:text-sm"
                        th:if="${#locale.language == 'zh'}"
                        th:text="#{page.archives.date_zh(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MM')},${#dates.format(post.spec.publishTime,'yy')})}"
                      ></span>
                      <span
                        class="text-xs text-white/80 md:text-sm"
                        th:if="${#locale.language != 'zh'}"
                        th:text="#{page.archives.date(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MMM')},${#dates.format(post.spec.publishTime,'yyyy')})}"
                      ></span>
                    </div>
                  </div>
                  <h2 class="mb-3 text-lg leading-tight font-bold text-white drop-shadow-lg md:text-2xl">
                    <a th:href="@{${post.status.permalink}}" th:text="${post.spec.title}"></a>
                  </h2>
                  <a aria-label="read" class="overflow-hidden transition-all duration-500 ease-in-out" th:href="@{${post.status.permalink}}">
                    <p
                      class="mb-3 line-clamp-3 text-sm leading-relaxed text-white md:mb-4 md:text-base"
                      th:classappend="${theme.config.index_blog.blog.blog_enabled == 'one' ? 'sm:line-clamp-2' : (theme.config.index_blog.blog.blog_enabled == 'two' ? 'sm:line-clamp-1' : '')}"
                      th:text="${post.status.excerpt}"
                    ></p>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-3 text-xs text-white/80 md:space-x-4 md:text-sm">
                        <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                          <i class="fas fa-eye"></i>
                          <span th:text="|${post.stats?.visit ?:0}|"></span>
                        </div>
                        <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                          <i class="fas fa-comment"></i>
                          <span th:text="|${post.stats?.comment ?:0}|"></span>
                        </div>
                        <div class="flex items-center space-x-1 rounded-full bg-white/10 px-2 py-1 backdrop-blur-sm">
                          <i class="fas fa-heart"></i>
                          <span th:text="|${post.stats?.upvote ?:0}|"></span>
                        </div>
                      </div>
                      <button class="cursor-pointer p-2 text-xs font-medium text-white transition-colors hover:text-blue-300 md:text-sm">
                        <a
                          aria-label="read"
                          class="group inline-flex items-center space-x-2 rounded-full bg-white/20 px-4 py-2 text-xs font-medium text-white backdrop-blur-sm transition-all duration-300 hover:scale-105 hover:bg-white/30 hover:shadow-lg md:text-sm"
                          th:href="@{${post.status.permalink}}"
                        >
                          <span th:text="#{widget.index.module.readMore}"></span>
                          <i class="fas fa-arrow-right transition-transform duration-300 group-hover:translate-x-1"></i>
                        </a>
                      </button>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </li>
          <li class="flex flex-col items-center justify-center py-12 text-center text-gray-500 lg:mt-10 lg:min-h-96" th:if="${posts.total == 0}">
            <svg class="mb-3 h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                d="M9 13h6m-6 4h6m-7 4h8a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-3.5l-1-2h-3l-1 2H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
              />
            </svg>
            <p class="text-lg font-medium" th:text="#{page.categories.error}"></p>
            <button
              class="mt-4 inline-flex items-center rounded-lg border border-gray-200/80 bg-gray-50/80 px-4 py-2 text-sm font-medium text-gray-700 transition-all duration-300 hover:bg-gray-100 hover:shadow-lg dark:border-transparent dark:bg-white/5 dark:text-gray-300 dark:hover:bg-white/10"
              onclick="history.back()"
            >
              <i class="fa-solid fa-rotate-left mr-2"></i>
              <span th:text="#{page.error.back}"></span>
            </button>
          </li>

          <th:block th:if="${posts.hasNext()}">
            <li class="mt-8 text-center" id="load-more-container"></li>
          </th:block>
        </ul>
        <!--  Category Aside  -->
        <div class="hidden lg:col-span-1 lg:block" th:if="${posts.total > 0}">
          <div class="sticky top-24 space-y-6 self-start">
            <ul class="overflow-hidden rounded-2xl border border-gray-200/70 bg-gray-400/5 p-6 backdrop-blur-sm dark:border-white/20 dark:bg-white/5">
              <th:block th:with="categories = ${categoryFinder.listAll()}">
                <li class="space-y-3">
                  <a
                    class="group relative flex items-center space-x-4 overflow-hidden rounded-xl border border-gray-200/80 bg-gray-50/80 p-4 transition-all duration-300 hover:-translate-y-1 hover:shadow-lg dark:border-transparent dark:bg-white/5"
                    th:each="category : ${categories}"
                    th:href="@{${category.status.permalink}}"
                  >
                    <div
                      class="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg shadow-md"
                      th:classappend="${#annotations.getOrDefault(category, 'color', 'gradient-bg-9')}"
                    >
                      <i class="text-sm text-white" th:classappend="${#annotations.getOrDefault(category, 'font', 'fas fa-file')}"></i>
                    </div>
                    <div class="flex-1 shrink-0">
                      <p class="font-semibold text-gray-900 dark:text-white" th:text="${category.spec.displayName}"></p>
                      <span class="text-sm text-gray-500 dark:text-gray-400" th:text="${category.status?.visiblePostCount ?: 0} + ' ' + #{page.archives.title.post}"></span>
                    </div>
                    <div class="hidden opacity-0 transition-opacity group-hover:opacity-100 xl:block">
                      <i class="fa-solid fa-person-walking-arrow-right"></i>
                    </div>
                  </a>
                </li>
              </th:block>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <th:block th:replace="~{modules/footer}" />
    <script th:inline="javascript">
      const categoryViewCount = new CategoryViewCount({
        readLabel: /*[[#{page.categoryView.readLabel}]]*/ "",
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        categoryViewCount.init();
      });
    </script>
  </th:block>
</html>
