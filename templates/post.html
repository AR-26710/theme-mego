<!doctype html>
<html th:replace="~{modules/layout :: html(title = ${post.spec.title} + ' - ' + ${site.title},head = null,content = ~{::content})}" xmlns:th="https://www.thymeleaf.org">
  <th:block th:fragment="content">
    <th:block th:replace="~{modules/header}" />
    <div class="mx-auto mt-20 max-w-7xl px-4 pb-8 transition-colors duration-300 sm:px-6 lg:mt-24 lg:px-8">
      <ul class="flex items-center space-x-4 pt-2 pb-6" th:if="${not #lists.isEmpty(post.categories)}">
        <li>
          <a class="text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" href="/" th:text="#{fragment.postHeader.home}"></a>
        </li>
        <th:block th:with="categoryItem=${post.categories[0]}">
          <li class="space-x-2 text-gray-500 last:font-medium dark:text-gray-400" th:each="category, stats : ${categoryFinder.getBreadcrumbs(categoryItem.metadata?.name)}">
            <i class="fa-solid fa-angle-right text-sm"></i>
            <a
              aria-current="page"
              class="text-sm hover:text-gray-700 dark:hover:text-gray-200"
              th:href="@{${category.status.permalink}}"
              th:text="${category.spec.displayName}"
            ></a>
          </li>
        </th:block>
      </ul>
      <div class="grid grid-cols-1 gap-8 xl:grid-cols-4">
        <div class="space-y-8 lg:col-span-3 lg:mr-4">
          <h1 class="text-4xl leading-tight font-bold text-gray-900 lg:text-5xl dark:text-white" th:text="${post.spec.title}"></h1>

          <div class="mb-12 flex items-center justify-between text-sm lg:justify-start">
            <div class="flex w-full items-center justify-between space-x-4 lg:w-auto">
              <div class="flex items-center space-x-2 text-gray-500 dark:text-gray-400">
                <div class="flex items-center space-x-1">
                  <i class="fas fa-calendar-day"></i>
                  <span
                    th:if="${#locale.language == 'zh'}"
                    th:text="#{page.archives.date_zh(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MM')},${#dates.format(post.spec.publishTime,'yy')})}"
                  ></span>
                  <span
                    th:if="${#locale.language != 'zh'}"
                    th:text="#{page.archives.date(${#dates.format(post.spec.publishTime,'dd')},${#dates.format(post.spec.publishTime,'MMM')},${#dates.format(post.spec.publishTime,'yyyy')})}"
                  ></span>
                </div>
                <div class="ml-2 hidden items-center space-x-1 sm:flex">
                  <i class="fas fa-clock"></i>
                  <span id="number"></span>
                </div>
                <div class="ml-2 space-x-2 md:[&>*]:!inline-block [&>*:nth-child(n+2)]:hidden">
                  <th:block th:each="tag : ${post.tags}">
                    <a class="text-gray-500 dark:text-gray-400" th:href="@{${tag.status.permalink}}" th:text="|#${tag.spec.displayName}|" th:title="${tag.spec.displayName}"></a>
                  </th:block>
                </div>
              </div>
              <div class="flex items-center space-x-4 lg:hidden">
                <div class="flex items-center space-x-1 text-gray-500 dark:text-gray-400">
                  <i class="fas fa-eye"></i>
                  <span th:text="|${post.stats?.visit ?:0}|"></span>
                </div>
                <a class="flex items-center space-x-1 text-gray-500 dark:text-gray-400" href="#comment">
                  <i class="fas fa-comment"></i>
                  <span th:text="|${post.stats?.comment ?:0}|"></span>
                </a>
                <button
                  class="header-upvote-btn flex items-center space-x-1 text-gray-600 transition-all duration-200 hover:scale-105 focus:outline-none dark:text-gray-400 dark:hover:text-red-400"
                  th:attr="data-article-name=${post.metadata.name}"
                >
                  <i class="fas fa-heart text-gray-500 transition-transform hover:scale-110 dark:text-gray-400"></i>
                  <span class="header-upvote-count" th:attr="data-upvote-header-name=${post.metadata.name}" th:text="|${post.stats?.upvote ?:0}|"></span>
                </button>
              </div>
            </div>
          </div>
          <section class="prose max-w-full text-gray-900 dark:text-white/70" th:utext="${post.content.content}"></section>
          <div class="py-5 sm:py-8" th:if="${haloCommentEnabled}">
            <halo:comment group="content.halo.run" kind="Post" th:attr="name=${post.metadata.name}" />
            <span id="comment"></span>
          </div>
        </div>
        <aside class="sticky top-24 hidden h-max w-full xl:col-span-1 xl:inline-block">
          <div class="mb-6 rounded-lg border border-gray-200 bg-gray-400/5 p-4 backdrop-blur-sm dark:border-white/20 dark:bg-white/5">
            <div class="mb-4">
              <div class="flex items-center text-lg font-semibold text-gray-900 dark:text-white">
                <i class="fas fa-circle-info mr-2 text-blue-600 dark:text-white"></i>
                <span th:text="#{fragment.postWidget.overview}"></span>
              </div>
            </div>
            <ul class="grid grid-cols-3 gap-2 text-center">
              <li class="rounded-lg border border-gray-200/80 bg-gray-50/80 p-2 dark:border-transparent dark:bg-white/5">
                <span class="text-base font-bold text-gray-700 dark:text-gray-300" th:text="${post.stats?.visit ?:0}"></span>
                <p class="text-xs text-gray-500 dark:text-gray-400" th:text="#{fragment.postWidget.read}"></p>
              </li>
              <li class="rounded-lg border border-gray-200/80 bg-gray-50/80 p-2 dark:border-transparent dark:bg-white/5">
                <span class="text-base font-bold text-gray-700 dark:text-gray-300" th:text="${post.stats?.comment ?:0}"></span>
                <p class="text-xs text-gray-500 dark:text-gray-400" th:text="#{fragment.postWidget.comment}"></p>
              </li>
              <li class="rounded-lg border border-gray-200/80 bg-gray-50/80 p-2 dark:border-transparent dark:bg-white/5">
                <span
                  class="sidebar-upvote-count text-base font-bold text-gray-700 dark:text-gray-300"
                  th:attr="data-upvote-sidebar-name=${post.metadata.name}"
                  th:text="${post.stats?.upvote ?:0}"
                ></span>
                <p class="text-xs text-gray-500 dark:text-gray-400" th:text="#{fragment.postWidget.upvote}"></p>
              </li>
            </ul>
          </div>
          <div class="rounded-lg border border-gray-200 bg-gray-400/5 p-4 backdrop-blur-sm dark:border-white/20 dark:bg-white/5" id="tocbot">
            <div class="mb-4 flex items-center text-lg font-semibold text-gray-900 dark:text-white">
              <i class="fas fa-list-ul mr-2 text-blue-600 dark:text-white"></i>
              <span th:text="#{page.post.toc}"></span></span>
            </div>
            <div class="toc max-h-[30rem] overflow-x-hidden overflow-y-auto scroll-smooth text-sm"></div>
          </div>
          <div class="mt-6 rounded-lg border border-gray-200 bg-gray-400/5 p-4 backdrop-blur-sm dark:border-white/20 dark:bg-white/5">
            <button
              class="upvote-btn group w-full rounded-lg bg-white/50 p-3 text-left transition-all duration-300 hover:scale-105 hover:bg-white/80 dark:border-gray-600/50 dark:bg-white/5 dark:hover:bg-gray-800/80"
              th:attr="data-article-name=${post.metadata.name}"
            >
              <div class="flex items-center space-x-3">
                <div
                  class="flex h-10 w-10 items-center justify-center rounded-full bg-gray-100 transition-colors group-hover:bg-red-50 dark:bg-gray-700 dark:group-hover:bg-red-900/30"
                >
                  <i class="fas fa-heart text-gray-400 transition-colors group-hover:text-red-400"></i>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    <span th:attr="data-upvote-post-name=${post.metadata.name}" th:text="|${post.stats?.upvote ?:0} | + |#{fragment.postWidget.likes.title}|"></span>
                  </p>
                  <p class="upvote-message text-xs text-gray-500 dark:text-gray-400" th:text="#{fragment.postWidget.likes.subtitle1}"></p>
                </div>
              </div>
            </button>
          </div>
        </aside>
      </div>
    </div>
    <th:block th:replace="~{modules/footer}" />
    <script th:src="@{/assets/js/tocbot.min.js}"></script>
    <script th:inline="javascript">
      readingTime.setI18n({
        read: /*[[#{fragment.postReadTime}]]*/ "",
        words: /*[[#{fragment.postWorlds}]]*/ "",
      });
      const postUpvote = new Upvote("halo.upvoted.post.names", "posts", undefined, {
        likedTitle: /*[[#{fragment.postWidget.likes.title}]]*/ "",
        subtitle1: /*[[#{fragment.postWidget.likes.subtitle1}]]*/ "",
        subtitle2: /*[[#{fragment.postWidget.likes.subtitle2}]]*/ "",
      });
    </script>
    <script>
      Tocbot();
      readingTime.calculate();
      postUpvote.init();
    </script>
  </th:block>
</html>
